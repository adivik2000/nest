Original evolution of this solution can be found at http://gist.github.com/41670